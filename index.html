<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Weekly Time Blocker - Plan your week with drag and drop time blocks">
    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiV2Vla2x5IFRpbWUgQmxvY2tlciIsInNob3J0X25hbWUiOiJUaW1lIEJsb2NrZXIiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzBmMTcyYSIsInRoZW1lX2NvbG9yIjoiIzBmMTcyYSIsImRlc2NyaXB0aW9uIjoiUGxhbiB5b3VyIHdlZWsgd2l0aCBkcmFnIGFuZCBkcm9wIHRpbWUgYmxvY2tzIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB3aWR0aD0nMTkyJyBoZWlnaHQ9JzE5Micgdmlld0JveD0nMCAwIDE5MiAxOTInJTNFJTNDcmVjdCB3aWR0aD0nMTkyJyBoZWlnaHQ9JzE5MicgZmlsbD0nJTIzMzhiZGY4Jy8lM0UlM0N0ZXh0IHg9JzUwJScgeT0nNTAlJyBmb250LXNpemU9JzgwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkb21pbmFudC1iYXNlbGluZT0nbWlkZGxlJyBmb250LWZhbWlseT0nc2Fucy1zZXJpZicgZmlsbD0nJTIzMGYxNzJhJyUzRVQlM0MvdGV4dCUzRSUzQy9zdmclM0UiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCIsInNpemVzIjoiMTkyeDE5MiJ9LHsic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyB2aWV3Qm94PScwIDAgNTEyIDUxMiclM0UlM0NyZWN0IHdpZHRoPSc1MTInIGhlaWdodD0nNTEyJyBmaWxsPSclMjMzOGJkZjgnLyUzRSUzQ3RleHQgeD0nNTAlJyB5PSc1MCUlMjcgZm9udC1zaXplPScyNDAnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGRvbWluYW50LWJhc2VsaW5lPSdtaWRkbGUnIGZvbnQtZmFtaWx5PSdzYW5zLXNlcmlmJyBmaWxsPSclMjMwZjE3MmEnJTNFVCUzQy90ZXh0JTNFJTNDL3N2ZyUzRSIsInR5cGUiOiJpbWFnZS9zdmcreG1sIiwic2l6ZXMiOiI1MTJ4NTEyIn1dfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180' viewBox='0 0 180 180'%3E%3Crect width='180' height='180' fill='%2338bdf8'/%3E%3Ctext x='50%25' y='50%25' font-size='80' text-anchor='middle' dominant-baseline='middle' font-family='sans-serif' fill='%230f172a'%3ET%3C/text%3E%3C/svg%3E">
    <title>Weekly Time Blocker 2026</title>
    <style>
        :root {
            --color-bg-base: #0f172a;
            --color-bg-elevated: #1e293b;
            --color-bg-surface: #334155;
            --color-text-primary: #f1f5f9;
            --color-text-secondary: #cbd5e1;
            --color-text-muted: #94a3b8;
            --color-primary: #38bdf8;
            --color-primary-hover: #0ea5e9;
            --color-border: rgba(148, 163, 184, 0.3);
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-bg-base);
            color: var(--color-text-primary);
            padding: 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            font-size: 2rem;
            color: var(--color-primary);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .install-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
            display: none;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .install-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .install-btn.show {
            display: block;
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--color-bg-elevated);
            padding: 10px 20px;
            border-radius: 8px;
        }

        .week-selector button {
            background: var(--color-primary);
            color: var(--color-bg-base);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background 0.2s;
        }

        .week-selector button:hover {
            background: var(--color-primary-hover);
        }

        .week-selector span {
            font-size: 1.1rem;
            font-weight: 500;
            min-width: 250px;
            text-align: center;
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        .task-pool {
            background: var(--color-bg-elevated);
            padding: 20px;
            border-radius: 12px;
            height: fit-content;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        .task-pool h2 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--color-primary);
        }

        .add-task-form {
            margin-bottom: 20px;
        }

        .add-task-form input,
        .add-task-form select {
            width: 100%;
            padding: 10px;
            background: var(--color-bg-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            color: var(--color-text-primary);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .add-task-form button {
            width: 100%;
            padding: 10px;
            background: var(--color-primary);
            color: var(--color-bg-base);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .add-task-form button:hover {
            background: var(--color-primary-hover);
        }

        .task-item {
            background: var(--color-bg-surface);
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: move;
            border: 2px solid transparent;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item:hover {
            border-color: var(--color-primary);
            transform: translateX(2px);
        }

        .task-item.dragging {
            opacity: 0.5;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .task-duration {
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .task-delete {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.2s;
        }

        .task-delete:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        .calendar-container {
            background: var(--color-bg-elevated);
            padding: 20px;
            border-radius: 12px;
            overflow-x: auto;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: 80px repeat(7, 1fr);
            gap: 1px;
            background: var(--color-border);
            border: 1px solid var(--color-border);
            min-width: 900px;
        }

        .calendar-header {
            background: var(--color-bg-surface);
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            color: var(--color-primary);
        }

        .calendar-header:first-child {
            background: transparent;
        }

        .time-label {
            background: var(--color-bg-surface);
            padding: 10px;
            text-align: center;
            font-size: 0.85rem;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .time-slot {
            background: var(--color-bg-base);
            padding: 8px;
            min-height: 40px;
            position: relative;
            transition: background 0.2s;
        }

        .time-slot.drag-over {
            background: rgba(56, 189, 248, 0.15);
            border: 2px dashed var(--color-primary);
        }

        .scheduled-task {
            background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
            padding: 10px;
            border-radius: 6px;
            cursor: move;
            margin-bottom: 5px;
            color: var(--color-bg-base);
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scheduled-task-content {
            flex: 1;
        }

        .scheduled-delete {
            background: rgba(15, 23, 42, 0.3);
            color: #ffffff;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background 0.2s;
            margin-left: 8px;
        }

        .scheduled-delete:hover {
            background: rgba(15, 23, 42, 0.5);
        }

        .scheduled-task:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .scheduled-task.dragging {
            opacity: 0.5;
        }

        .scheduled-duration {
            font-size: 0.75rem;
            opacity: 0.9;
            margin-top: 2px;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--color-bg-elevated);
            padding: 15px 20px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-primary);
        }

        .install-instructions {
            background: var(--color-bg-elevated);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--color-primary);
        }

        .install-instructions h3 {
            color: var(--color-primary);
            margin-bottom: 15px;
        }

        .install-instructions ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .install-instructions code {
            background: var(--color-bg-surface);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .task-pool {
                max-height: 400px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Weekly Time Blocker 2026</h1>
            <div class="header-actions">
                <button id="installBtn" class="install-btn">üì≤ Install App</button>
                <div class="week-selector">
                    <button id="prevWeek">&larr; Previous</button>
                    <span id="weekDisplay">Loading...</span>
                    <button id="nextWeek">Next &rarr;</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="task-pool">
                <h2>Activity Pool</h2>
                <div class="add-task-form">
                    <input type="text" id="taskName" placeholder="Activity name">
                    <select id="taskDuration">
                        <option value="0.25">15 minutes</option>
                        <option value="0.5">30 minutes</option>
                        <option value="1" selected>1 hour</option>
                        <option value="1.5">1.5 hours</option>
                        <option value="2">2 hours</option>
                        <option value="2.5">2.5 hours</option>
                        <option value="3">3 hours</option>
                        <option value="3.5">3.5 hours</option>
                        <option value="4">4 hours</option>
                        <option value="4.5">4.5 hours</option>
                        <option value="5">5 hours</option>
                        <option value="6">6 hours</option>
                        <option value="8">8 hours</option>
                    </select>
                    <button id="addTask">Add Activity</button>
                </div>
                <div id="taskList"></div>
            </div>

            <div class="calendar-container">
                <div class="calendar-grid" id="calendar"></div>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Hours Scheduled</div>
                        <div class="stat-value" id="totalHours">0h</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Activities Scheduled</div>
                        <div class="stat-value" id="totalTasks">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Unscheduled Activities</div>
                        <div class="stat-value" id="unscheduledTasks">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="install-instructions">
            <h3>üöÄ How to Install & Share This App</h3>
            <ol>
                <li><strong>Install on Your Device:</strong> Click the "üì≤ Install App" button above (appears in supported browsers)</li>
                <li><strong>Download HTML File:</strong> Click the download button (‚¨áÔ∏è) in the top-right corner</li>
                <li><strong>Share with Others:</strong>
                    <ul style="margin-top: 10px;">
                        <li><strong>Email:</strong> Send the HTML file as attachment</li>
                        <li><strong>Cloud Storage:</strong> Upload to Google Drive, Dropbox, or OneDrive and share the link</li>
                        <li><strong>Host Online (Free):</strong>
                            <ul style="margin-top: 8px;">
                                <li><strong>GitHub Pages:</strong> Create account ‚Üí Upload as <code>index.html</code> ‚Üí Enable Pages in settings</li>
                                <li><strong>Netlify Drop:</strong> Visit app.netlify.com/drop and drag the file</li>
                                <li><strong>Vercel:</strong> Upload at vercel.com for instant deployment</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Mobile Install:</strong> Open in Chrome/Safari ‚Üí Tap Share ‚Üí "Add to Home Screen"</li>
            </ol>
        </div>
    </div>

    <script>
        let deferredPrompt;
        let tasks = [
            { id: 1, name: 'Exercise', duration: 1, color: '#38bdf8' },
            { id: 2, name: 'Study', duration: 2, color: '#0ea5e9' },
            { id: 3, name: 'Work Project', duration: 4, color: '#0284c7' },
            { id: 4, name: 'Meeting', duration: 0.5, color: '#0369a1' }
        ];

        let schedule = {};
        let currentWeekStart = new Date(2026, 0, 5);
        let draggedElement = null;
        let draggedTaskId = null;
        let dragSource = null;

        const timeSlots = [
            '6:00 AM', '6:15 AM', '6:30 AM', '6:45 AM',
            '7:00 AM', '7:15 AM', '7:30 AM', '7:45 AM',
            '8:00 AM', '8:15 AM', '8:30 AM', '8:45 AM',
            '9:00 AM', '9:15 AM', '9:30 AM', '9:45 AM',
            '10:00 AM', '10:15 AM', '10:30 AM', '10:45 AM',
            '11:00 AM', '11:15 AM', '11:30 AM', '11:45 AM',
            '12:00 PM', '12:15 PM', '12:30 PM', '12:45 PM',
            '1:00 PM', '1:15 PM', '1:30 PM', '1:45 PM',
            '2:00 PM', '2:15 PM', '2:30 PM', '2:45 PM',
            '3:00 PM', '3:15 PM', '3:30 PM', '3:45 PM',
            '4:00 PM', '4:15 PM', '4:30 PM', '4:45 PM',
            '5:00 PM', '5:15 PM', '5:30 PM', '5:45 PM',
            '6:00 PM', '6:15 PM', '6:30 PM', '6:45 PM',
            '7:00 PM', '7:15 PM', '7:30 PM', '7:45 PM',
            '8:00 PM', '8:15 PM', '8:30 PM', '8:45 PM',
            '9:00 PM'
        ];

        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBtn').classList.add('show');
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('App installed');
                }
                deferredPrompt = null;
                document.getElementById('installBtn').classList.remove('show');
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            document.getElementById('installBtn').classList.remove('show');
        });

        function init() {
            loadData();
            renderTaskList();
            renderCalendar();
            updateWeekDisplay();
            updateStats();

            document.getElementById('addTask').addEventListener('click', addTask);
            document.getElementById('prevWeek').addEventListener('click', () => changeWeek(-1));
            document.getElementById('nextWeek').addEventListener('click', () => changeWeek(1));

            document.getElementById('taskName').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
        }

        function loadData() {
            const savedTasks = localStorage.getItem('timeblocker_tasks');
            const savedSchedule = localStorage.getItem('timeblocker_schedule');
            
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
            
            if (savedSchedule) {
                schedule = JSON.parse(savedSchedule);
            }
        }

        function saveData() {
            localStorage.setItem('timeblocker_tasks', JSON.stringify(tasks));
            localStorage.setItem('timeblocker_schedule', JSON.stringify(schedule));
        }

        function addTask() {
            const nameInput = document.getElementById('taskName');
            const durationInput = document.getElementById('taskDuration');
            
            const name = nameInput.value.trim();
            const duration = parseFloat(durationInput.value);

            if (name && duration > 0) {
                const newTask = {
                    id: Date.now(),
                    name: name,
                    duration: duration,
                    color: '#38bdf8'
                };
                tasks.push(newTask);
                nameInput.value = '';
                durationInput.value = '1';
                saveData();
                renderTaskList();
                updateStats();
            }
        }

        function formatDuration(hours) {
            if (hours < 1) {
                return `${hours * 60}min`;
            } else if (hours % 1 === 0) {
                return `${hours}h`;
            } else {
                const h = Math.floor(hours);
                const m = (hours % 1) * 60;
                return `${h}h ${m}min`;
            }
        }

        function deleteScheduledTask(slotKey, taskId) {
            if (schedule[slotKey]) {
                schedule[slotKey] = schedule[slotKey].filter(t => t.id !== taskId);
                if (schedule[slotKey].length === 0) {
                    delete schedule[slotKey];
                }
            }
            saveData();
            renderCalendar();
            updateStats();
        }

        function deleteTask(taskId) {
            tasks = tasks.filter(t => t.id !== taskId);
            Object.keys(schedule).forEach(key => {
                schedule[key] = schedule[key].filter(t => t.id !== taskId);
            });
            saveData();
            renderTaskList();
            renderCalendar();
            updateStats();
        }

        function renderTaskList() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';

            tasks.forEach(task => {
                const taskEl = document.createElement('div');
                taskEl.className = 'task-item';
                taskEl.draggable = true;
                taskEl.dataset.taskId = task.id;

                taskEl.innerHTML = `
                    <div class="task-info">
                        <div class="task-name">${task.name}</div>
                        <div class="task-duration">${formatDuration(task.duration)}</div>
                    </div>
                    <button class="task-delete" onclick="deleteTask(${task.id})">Delete</button>
                `;

                taskEl.addEventListener('dragstart', handleDragStart);
                taskEl.addEventListener('dragend', handleDragEnd);

                taskList.appendChild(taskEl);
            });
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            calendar.appendChild(createHeader(''));
            days.forEach((day, index) => {
                const date = new Date(currentWeekStart);
                date.setDate(date.getDate() + index);
                const dateStr = `${day}<br><span style="font-size: 0.85rem; font-weight: normal;">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>`;
                calendar.appendChild(createHeader(dateStr));
            });

            timeSlots.forEach(time => {
                calendar.appendChild(createTimeLabel(time));
                days.forEach((day, dayIndex) => {
                    calendar.appendChild(createTimeSlot(day, time, dayIndex));
                });
            });
        }

        function createHeader(text) {
            const header = document.createElement('div');
            header.className = 'calendar-header';
            header.innerHTML = text;
            return header;
        }

        function createTimeLabel(time) {
            const label = document.createElement('div');
            label.className = 'time-label';
            label.textContent = time;
            return label;
        }

        function createTimeSlot(day, time, dayIndex) {
            const slot = document.createElement('div');
            slot.className = 'time-slot';
            slot.dataset.day = day;
            slot.dataset.time = time;

            const slotKey = `${day}-${time}`;
            if (schedule[slotKey]) {
                schedule[slotKey].forEach(task => {
                    const taskEl = createScheduledTask(task, slotKey);
                    slot.appendChild(taskEl);
                });
            }

            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('drop', handleDrop);
            slot.addEventListener('dragleave', handleDragLeave);

            return slot;
        }

        function createScheduledTask(task, slotKey) {
            const taskEl = document.createElement('div');
            taskEl.className = 'scheduled-task';
            taskEl.draggable = true;
            taskEl.dataset.taskId = task.id;
            taskEl.dataset.slotKey = slotKey;
            
            const slotsNeeded = Math.ceil(task.duration / 0.25);
            const heightMultiplier = slotsNeeded * 40 - 5;
            taskEl.style.minHeight = `${heightMultiplier}px`;
            taskEl.style.background = `linear-gradient(135deg, ${task.color} 0%, ${adjustColor(task.color, -20)} 100%)`;

            taskEl.innerHTML = `
                <div class="scheduled-task-content">
                    <div>${task.name}</div>
                    <div class="scheduled-duration">${formatDuration(task.duration)}</div>
                </div>
                <button class="scheduled-delete" onclick="deleteScheduledTask('${slotKey}', ${task.id})">‚úï</button>
            `;

            taskEl.addEventListener('dragstart', handleScheduledDragStart);
            taskEl.addEventListener('dragend', handleDragEnd);

            return taskEl;
        }

        function adjustColor(color, amount) {
            const num = parseInt(color.slice(1), 16);
            const r = Math.max(0, Math.min(255, (num >> 16) + amount));
            const g = Math.max(0, Math.min(255, ((num >> 8) & 0x00FF) + amount));
            const b = Math.max(0, Math.min(255, (num & 0x0000FF) + amount));
            return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            draggedTaskId = parseInt(e.target.dataset.taskId);
            dragSource = 'pool';
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleScheduledDragStart(e) {
            draggedElement = e.target;
            draggedTaskId = parseInt(e.target.dataset.taskId);
            dragSource = e.target.dataset.slotKey;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            const slot = e.currentTarget;
            slot.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');

            const targetSlot = e.currentTarget;
            const slotKey = `${targetSlot.dataset.day}-${targetSlot.dataset.time}`;

            const task = tasks.find(t => t.id === draggedTaskId);
            if (!task) return;

            if (dragSource === 'pool') {
                if (!schedule[slotKey]) schedule[slotKey] = [];
                schedule[slotKey].push({ ...task });
            } else {
                if (schedule[dragSource]) {
                    const taskIndex = schedule[dragSource].findIndex(t => t.id === draggedTaskId);
                    if (taskIndex > -1) {
                        const [movedTask] = schedule[dragSource].splice(taskIndex, 1);
                        if (!schedule[slotKey]) schedule[slotKey] = [];
                        schedule[slotKey].push(movedTask);
                    }
                }
            }

            saveData();
            renderCalendar();
            updateStats();
        }

        function changeWeek(direction) {
            currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            updateWeekDisplay();
            renderCalendar();
        }

        function updateWeekDisplay() {
            const endDate = new Date(currentWeekStart);
            endDate.setDate(endDate.getDate() + 6);
            
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            const startStr = currentWeekStart.toLocaleDateString('en-US', options);
            const endStr = endDate.toLocaleDateString('en-US', options);
            
            document.getElementById('weekDisplay').textContent = `${startStr} - ${endStr}`;
        }

        function updateStats() {
            let totalHours = 0;
            let totalScheduled = 0;

            Object.values(schedule).forEach(slotTasks => {
                slotTasks.forEach(task => {
                    totalHours += task.duration;
                    totalScheduled++;
                });
            });

            document.getElementById('totalHours').textContent = formatDuration(totalHours);
            document.getElementById('totalTasks').textContent = totalScheduled;
            document.getElementById('unscheduledTasks').textContent = tasks.length;
        }

        init();
    </script>
</body>
</html>

